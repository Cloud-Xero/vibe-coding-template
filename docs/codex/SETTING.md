## Codex CLI 設定と実行環境ガイド

このドキュメントは Codex CLI（OpenAI のコマンドライン型コーディングエージェント）の設定観点と実行環境の前提を整理したものです。Codex で重要なポリシーと運用ルールをまとめています。

### 1. 実行環境と権限レベル

- **ファイルシステムサンドボックス**: `read-only` / `workspace-write` / `danger-full-access`
- **ネットワーク**: `restricted` / `enabled`
- **承認モード**: `on-request` / `on-failure` / `never` / `untrusted`

Codex は各操作前に環境の制約を考慮します。書き込みやネットワークを伴う操作は、必要に応じて承認を要求します。

### 2. セキュリティポリシー例

危険コマンドや機密情報の取り扱いについて、プロジェクト方針を明文化します。

#### 禁止コマンド（例）
- `rm -rf` / `sudo rm -rf`
- `del /f /q`（Windows）
- `format <drive>`（Windows）
- `dd if=/dev/zero of=/dev/*`

#### 検出対象パターン（例）
- `password\s*=\s*["'][^"']+["']`
- `api_key\s*=\s*["'][^"']+["']`
- `token\s*=\s*["'][^"']+["']`
- `private_key\s*=\s*["'][^"']+["']`

### 3. ファイルアクセス制限

#### 禁止拡張子（例）
- `.exe`, `.bat`, `.cmd`, `.scr`, `.pif`, `.vbs`, `.jar`

#### 禁止パス（例）
- `/etc/passwd`, `/etc/shadow`, `~/.ssh/id_rsa`, `~/.aws/credentials`

### 4. 実行前の確認が必要な操作

- データベース操作（DROP, DELETE, 破壊的変更）
- システム設定変更（権限・所有者・サービス設定）
- ネットワーク外部呼び出し（API 送信、依存取得）
- ファイル削除・大規模移動

### 5. 開発ガイドライン

- 入力値の検証とサニタイズを徹底
- パラメータ化クエリを使用（SQL インジェクション対策）
- レート制限・監査ログを適用
- HTTPS 必須・秘密情報は環境変数で注入

### 6. プロジェクト標準構成

- 必須ファイル: `.env.example`, `.gitignore`, `README.md`
- 依存管理: 言語に応じて `requirements.txt` / `package.json` / `go.mod` など
- Git に含めないもの: `.env`, `*.key`, `*.pem`, `*.log`, 機密設定

### 7. Codex の設定と利用上の約束

- **承認フロー**: 破壊的操作・外部通信・書き込みは必要に応じて承認を取得
- **変更最小化**: 目的に直接関係しない修正は行わない
- **説明責任**: 重要操作の前後で短いプレリード／進捗報告を行う

### 8. 便利コマンド例（参考）

```
# 現在の計画を更新（内部の plan 機能に相当）
# → ユーザー確認ポイントの明確化や段階実行に有効

# 重要操作の前に前置きメッセージ（preamble）を入れる
# → これから何をするかを 1–2 行で共有

# `apply_patch` を用いた差分適用
# → 変更が明確かつレビュー容易、巻き戻しも容易

# `shell` を用いた読み取り・テスト・ビルド
# → 破壊的操作は承認を経て実行
```

### 9. まとめ

Codex CLI は承認・サンドボックス・計画共有を前提に、安全かつ最小変更で作業を進めます。上記ポリシー（禁止コマンド・検出パターン・確認必須操作）をプロジェクトの共通ルールとして運用することで、再現性と安全性を両立できます。

